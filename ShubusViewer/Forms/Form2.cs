using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
//using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace ShubusViewer
{
    public partial class Form2 : Form
    {
        private const string gameScript =
        "PGhlYWQ+CjxzY3JpcHQgbGFuZ3VhZ2UgPSAiSmF2YVNjcmlwdCI+Ci8vICBTbmFrZSAxLjAgLSBnYW1lIGZvciB3ZWIgYnJvd3NlcnMuCgogICAgdmFyIGlzTlMgPSAoICggbmF2aWdhdG9yLmFwcE5hbWUgPT0gIk5ldHNjYXBlIiApIHx8ICggbmF2aWdhdG9yLmFwcE5hbWUgPT0gIk9wZXJhIiApICk7CiAgICB2YXIgc25EZWxheTsgICAgLy8gU3BlZWQgZGVjcmVhc2UKICAgIHZhciBwaWNDb3VudDsgICAvLyBVc2VyIHNjb3JlCiAgICB2YXIgZmlyc3RseSA9IDE7Ly8gRmlyc3QgdGltZSBwbGF5IGZsYWcKICAgIHZhciB0aW1lciA9IDA7ICAvLyBUaW1lciBJRAogICAgdmFyIGFpTW9kZTsgICAgIC8vIEFJIG1vZGUgb24vb2ZmCiAgICB2YXIgYWlQYXRoID0gIiI7CiAgICB2YXIgYWlBcnI7CiAgICB2YXIgeGFycjsKICAgIHZhciB5YXJyOwogICAgdmFyIGhlYWRTZWc7ICAgIC8vIEhlYWQgb2Ygc25ha2UKICAgIHZhciBoZWFkX3g7ICAgICAvLyB4IG9mIGhlYWQgCiAgICB2YXIgaGVhZF95OyAgICAgLy8geSBvZiBoZWFkCiAgICB2YXIgaGVhZF9zeiA9IDA7Ly8gaGVhZCBzaXplCiAgICB2YXIgbWF4X3g7ICAgICAgLy8gc25ha2UgaGVhZCBib3VuZHMKICAgIHZhciBtYXhfeTsKICAgIHZhciBtaW5feDsKICAgIHZhciBtaW5feTsKICAgIHZhciB3d2lkdGg7ICAgICAvLyB3aW5kb3cgc2l6ZQogICAgdmFyIHdoZWlnaHQ7CiAgICB2YXIgc25ha2VfcmVjb3JkID0gMDsKICAgIHZhciB5ZGlyLCB4ZGlyOwoKICAgIGZ1bmN0aW9uIGVudHJ5UG9pbnQoKQogICAgewogICAgICAgIGluaXRWYXJpYWJsZXMoKTsKICAgICAgICBpZiAoIGZpcnN0bHkgKSBnZXRQaWNTaXplKCk7CiAgICAgICAgCiAgICAgICAgaWYgKCBkcmF3Qm9yZGVyKCkgKQogICAgICAgIHsKICAgICAgICAgICAgYWlJbml0KCk7CiAgICAgICAgICAgIHNuYWtlQ3JlYXRlSGVhZCgpOwogICAgICAgICAgICBzbmFrZUFkZE5ld1RhcmdldCgpOwogICAgICAgICAgICBnYW1lU2hvd1RpdGxlKCk7CiAgICAgICAgICAgIGdhbWVTaG93U2NvcmUoKTsKICAgICAgICAgICAgZmlyc3RseSA/IGRsZ0RyYXdXZWxjb21lKCkgOiBhdHRhY2hFdmVudHMoKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgZGxnRHJhd1VuYWJsZSgpOwogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gaW5pdFZhcmlhYmxlcygpCiAgICB7CiAgICAgICAgc25EZWxheSA9IDEwMDsKICAgICAgICBhaU1vZGUgPSAwOwogICAgICAgIHBpY0NvdW50ID0gMDsKICAgICAgICB5ZGlyID0geGRpciA9ICcnOwoKICAgICAgICBpZiAoaXNOUykKICAgICAgICB7CiAgICAgICAgICAgIHd3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOwogICAgICAgICAgICB3aGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB3d2lkdGggPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoOwogICAgICAgICAgICB3aGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiBnYW1lU2hvd1RpdGxlKCkKICAgIHsKICAgICAgICB2YXIgdGl0bGVUeHQgPSAnJzsKICAgICAgICB2YXIgaW5mb1RleHQgPSAnJzsKICAgICAgICB2YXIgc2NvcmVUeHQgPSAiIFNjb3JlOiAiICsgKCBwaWNDb3VudCAtIDIgKTsKICAgICAgICB2YXIgaW5mb0NlbnRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAiaW5mb19jZW50ZXIiICk7CgogICAgICAgIGlmICggZmlyc3RseSApCiAgICAgICAgewogICAgICAgICAgICB0aXRsZVR4dCA9ICJTbmFrZSBHYW1lOiBIZWxsbyEiOwogICAgICAgICAgICBpbmZvVGV4dCA9ICI8c3Ryb25nPldlbGNvbWUgdG8gU25ha2UgMS4wPC9zdHJvbmc+IjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoIHlkaXIgPT0gMCAmJiB4ZGlyID09IDAgKQogICAgICAgIHsKICAgICAgICAgICAgdGl0bGVUeHQgPSAiU25ha2UgR2FtZTogV2FpdGluZyBmb3Igc3RhcnQuLiI7CiAgICAgICAgICAgIGluZm9UZXh0ID0gIjxzdHJvbmc+UHJlc3MgYXJyb3cga2V5IHRvIHN0YXJ0IHRoZSBnYW1lLjwvc3Ryb25nPiI7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKCB0aW1lciApCiAgICAgICAgewogICAgICAgICAgICB0aXRsZVR4dCA9ICJSdW5uaW5nLi4iICsgc2NvcmVUeHQ7CiAgICAgICAgICAgIGluZm9UZXh0ID0gIjxzdHJvbmc+UHJlc3Mgc3BhY2ViYXIgZm9yIHBhdXNlLjwvc3Ryb25nPiI7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGxnR2FtZU92ZXInKSApCiAgICAgICAgewogICAgICAgICAgICB0aXRsZVR4dCA9ICJHQU1FIE9WRVIuIiArIHNjb3JlVHh0OwogICAgICAgICAgICBpbmZvVGV4dCA9ICI8c3Ryb25nPkdBTUUgT1ZFUi48c3Ryb25nPiI7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7ICAKICAgICAgICAgICAgdGl0bGVUeHQgPSAiUGF1c2VkLiIgKyBzY29yZVR4dDsKICAgICAgICAgICAgaW5mb1RleHQgPSAiPHN0cm9uZz5HYW1lIHBhdXNlZC4gUHJlc3Mgc3BhY2ViYXIgdG8gY29udGludWUuPC9zdHJvbmc+IjsKICAgICAgICB9CiAgICAgICAgaWYgKCB0aXRsZVR4dCApIGRvY3VtZW50LnRpdGxlID0gdGl0bGVUeHQ7CiAgICAgICAgaWYgKCBpbmZvQ2VudGVyICkgaW5mb0NlbnRlci5pbm5lckhUTUwgPSBpbmZvVGV4dDsKICAgIH0JCgoKICAgIGZ1bmN0aW9uIGdhbWVTaG93U2NvcmUoKQogICAgewogICAgICAgIHZhciBzY29yZSA9IHBpY0NvdW50IC0gMjsKICAgICAgICB2YXIgbXlEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggImluZm9fcmlnaHQiICk7CiAgICAgICAgbXlEaXYuaW5uZXJIVE1MID0gIjxzdHJvbmc+U2NvcmUgOiAiICsgc2NvcmUgKyAiPC9zdHJvbmc+IjsKCiAgICAgICAgaWYgKCBzbmFrZV9yZWNvcmQgJiYgc2NvcmUgPiBzbmFrZV9yZWNvcmQgKQogICAgICAgIHsKICAgICAgICAgICAgbXlEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggImluZm9fbGVmdCIgKTsKICAgICAgICAgICAgbXlEaXYuaW5uZXJIVE1MID0gIjxzdHJvbmc+UmVjb3JkIDogIiArIHNjb3JlICsgIjwvc3Ryb25nPiI7CiAgICAgICAgICAgIG15RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICJpbmZvX3JpZ2h0IiApOwogICAgICAgICAgICBteURpdi5pbm5lckhUTUwgPSAiPHN0cm9uZz5PbGQgUmVjOiAiICsgc25ha2VfcmVjb3JkICsgIjwvc3Ryb25nPiI7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIG15RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICJpbmZvX3JpZ2h0IiApOwogICAgICAgICAgICBteURpdi5pbm5lckhUTUwgPSAiPHN0cm9uZz5TY29yZSA6ICIgKyBzY29yZSArICI8L3N0cm9uZz4iOwogICAgICAgIH0KICAgICAgICBpZiAoIHRpbWVyICkKICAgICAgICB7CiAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gIlJ1bm5pbmcuLiBTY29yZTogIiArIHNjb3JlOwogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gYXR0YWNoRXZlbnRzKCkKICAgIHsKICAgICAgICBkb2N1bWVudC5vbmtleWRvd24gPSBzdGFydEhhbmRsZXI7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBCcm93c2VyLWRlcGVuZGVudCBjb2RlIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiBnZXROdW0oIHN0cl9weCApCiAgICB7CiAgICAgICAgdmFyIG51bSA9IDA7CgogICAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgc3RyX3B4Lmxlbmd0aCAtIDI7IGkrKyApCiAgICAgICAgewogICAgICAgICAgIG51bSA9IDEgKiBzdHJfcHguY2hhckF0KCBpICkgKyBudW0gKiAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bTsKICAgIH0KCgogICAgZnVuY3Rpb24gc25ha2VHZXRTZWdtZW50KCBhcmdfc2VnSWQgKQogICAgewogICAgICAgIHZhciBzbmFrZVNlZzsKICAgICAgICAKICAgICAgICBpZiAoIGlzTlMgKQogICAgICAgIHsKICAgICAgICAgICAgc25ha2VTZWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggYXJnX3NlZ0lkICkuc3R5bGU7CiAgICAgICAgICAgIHNuYWtlU2VnLnNlZ1ggPSBnZXROdW0oIHNuYWtlU2VnLmxlZnQgKTsKICAgICAgICAgICAgc25ha2VTZWcuc2VnWSA9IGdldE51bSggc25ha2VTZWcudG9wICk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHNuYWtlU2VnID0gZXZhbCgnZG9jdW1lbnQuYWxsLicgKyBhcmdfc2VnSWQgKyAnLnN0eWxlJyk7CiAgICAgICAgICAgIHNuYWtlU2VnLnNlZ1ggID0gc25ha2VTZWcucGl4ZWxMZWZ0OwogICAgICAgICAgICBzbmFrZVNlZy5zZWdZICA9IHNuYWtlU2VnLnBpeGVsVG9wOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc25ha2VTZWc7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHNuYWtlTW92ZURpdlRvKCBhcmdfc2VnX3N0eWxlLCBhcmdfeCwgYXJnX3kgKQogICAgewogICAgICAgIGlmICggaXNOUyApCiAgICAgICAgewogICAgICAgICAgICBhcmdfc2VnX3N0eWxlLmxlZnQgPSBhcmdfeDsKICAgICAgICAgICAgYXJnX3NlZ19zdHlsZS50b3AgPSBhcmdfeTsKICAgICAgICB9CQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGFyZ19zZWdfc3R5bGUucGl4ZWxMZWZ0ID0gYXJnX3g7CiAgICAgICAgICAgIGFyZ19zZWdfc3R5bGUucGl4ZWxUb3AgID0gYXJnX3k7CiAgICAgICAgfQoKICAgICAgICBhcmdfc2VnX3N0eWxlLnNlZ1ggPSBhcmdfeDsKICAgICAgICBhcmdfc2VnX3N0eWxlLnNlZ1kgPSBhcmdfeTsKICAgIH0KCgogICAgZnVuY3Rpb24gZ2V0UGljU2l6ZSgpCiAgICB7CiAgICAgICAgdmFyIG9iamVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHZhciBkb2NCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTsKICAgICAgICBvYmplY3QuaWQgPSAidGVzdCI7CiAgICAgICAgb2JqZWN0LmlubmVySFRNTCA9ICc8aW1nIHNyYz0iaW1nL2hlYWQuZ2lmIiBib3JkZXI9IjAiPic7CiAgICAgICAgb2JqZWN0LnN0eWxlLmNzc1RleHQgPSAiWi1JTkRFWDogMTsgUE9TSVRJT046IGFic29sdXRlOyBWSVNJQklMSVRZOiB2aXNpYmxlIjsKICAgICAgICBkb2NCb2R5LmFwcGVuZENoaWxkKCBvYmplY3QgKTsKICAgICAgICB2YXIgcGljV2lkdGggPSBvYmplY3QuY2xpZW50V2lkdGg7CiAgICAgICAgdmFyIHBpY0hlaWdodCA9IG9iamVjdC5jbGllbnRIZWlnaHQ7CiAgICAgICAgZG9jQm9keS5yZW1vdmVDaGlsZCggZG9jQm9keS5sYXN0Q2hpbGQgKTsKICAgICAgICAKICAgICAgICBpZiAoIHBpY1dpZHRoIHx8IHBpY0hlaWdodCApCiAgICAgICAgewogICAgICAgICAgICBoZWFkX3N6ID0gKCBwaWNXaWR0aCA8IHBpY0hlaWdodCApID8gcGljV2lkdGggOiBwaWNIZWlnaHQ7CiAgICAgICAgfQogICAgICAgIGVsc2UgLy8gSXNzdWUgNTg3MTUgLSAgaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9NTg3MTUKICAgICAgICB7CiAgICAgICAgICAgIGhlYWRfc3ogPSAyMDsKICAgICAgICB9CiAgICB9CgoKIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gQnJvd3Nlci11bmRlcGVuZGVudCBjb2RlIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiBzbmFrZUNyZWF0ZUhlYWQoKQogICAgewogICAgICAgIHZhciBvYmplY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBvYmplY3QuaWQgPSAic2VnMSI7CiAgICAgICAgb2JqZWN0LmlubmVySFRNTCA9ICc8aW1nIHNyYz0iaW1nL2hlYWQuZ2lmIiBhbHQ9IiIgYm9yZGVyPSIwIj4nOwogICAgICAgIG9iamVjdC5zdHlsZS5jc3NUZXh0ID0gIlotSU5ERVg6IDI7IFBPU0lUSU9OOiBhYnNvbHV0ZTsgVklTSUJJTElUWTogdmlzaWJsZSI7CiAgICAgICAgb2JqZWN0Lmxhc3RDaGlsZC53aWR0aCA9IGhlYWRfc3o7CiAgICAgICAgb2JqZWN0Lmxhc3RDaGlsZC5oZWlnaHQgPSBoZWFkX3N6OwogICAgICAgIGhlYWRfeCA9IG1pbl94OwogICAgICAgIGhlYWRfeSA9IG1pbl95OwogICAgICAgIHNuYWtlTW92ZURpdlRvKCBvYmplY3Quc3R5bGUsIGhlYWRfeCwgaGVhZF95ICk7ICAgICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0uYXBwZW5kQ2hpbGQoIG9iamVjdCApOwogICAgICAgIGhlYWRTZWcgPSBzbmFrZUdldFNlZ21lbnQoIG9iamVjdC5pZCApOwogICAgICAgIGhlYWRTZWcuYmFja2dyb3VuZENvbG9yID0gIiMwMEZGMDAiOwogICAgICAgIHBpY0NvdW50ID0gMTsKICAgIH0KCgogICAgZnVuY3Rpb24gc25ha2VBZGROZXdUYXJnZXQoKQogICAgewogICAgICAgIHZhciBvYmplY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBwaWNDb3VudCsrOwogICAgICAgIG9iamVjdC5pZCA9ICJzZWciICsgcGljQ291bnQ7CiAgICAgICAgb2JqZWN0LmlubmVySFRNTCA9ICc8aW1nIHNyYz0iaW1nL3NlZy5naWYiIGFsdD0iIiBib3JkZXI9IjAiPic7CiAgICAgICAgb2JqZWN0LnN0eWxlLmNzc1RleHQgPSAiWi1JTkRFWDogMTsgUE9TSVRJT046IGFic29sdXRlOyBWSVNJQklMSVRZOiB2aXNpYmxlIjsKICAgICAgICBvYmplY3Quc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiNGRjYzNDciOwogICAgICAgIG9iamVjdC5sYXN0Q2hpbGQud2lkdGggPSBoZWFkX3N6OwogICAgICAgIG9iamVjdC5sYXN0Q2hpbGQuaGVpZ2h0ID0gaGVhZF9zejsKICAgICAgICB2YXIgcm5kX3ggPSBnZXRyYW5kb20oIG1pbl94LCBtYXhfeCApOwogICAgICAgIHZhciBybmRfeSA9IGdldHJhbmRvbSggbWluX3ksIG1heF95ICk7CiAgICAgICAgc25ha2VNb3ZlRGl2VG8oIG9iamVjdC5zdHlsZSwgcm5kX3gsIHJuZF95ICk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5hcHBlbmRDaGlsZCggb2JqZWN0ICk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGdldHJhbmRvbSggbWluX3JhbmRvbSwgbWF4X3JhbmRvbSApCiAgICB7CiAgICAgICAgdmFyIHJhbmdlID0gbWF4X3JhbmRvbSAtIG1pbl9yYW5kb20gKyAxOwogICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByYW5nZSkgKyBtaW5fcmFuZG9tOwogICAgfQoKCiAgICBmdW5jdGlvbiBzbmFrZURyYWcoKQogICAgewogICAgICAgIGZvciAoIHZhciBpID0gcGljQ291bnQgLSAxOyBpID4gMTsgaS0tICkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBpZEN1ciA9ICJzZWciICsgaTsKICAgICAgICAgICAgdmFyIGlkTmV4dCA9ICJzZWciICsgKCBpIC0gMSApOwogICAgICAgICAgICB2YXIgY3VyU2VnID0gc25ha2VHZXRTZWdtZW50KCBpZEN1ciApOwogICAgICAgICAgICB2YXIgbnh0U2VnID0gc25ha2VHZXRTZWdtZW50KCBpZE5leHQgKTsKICAgICAgICAgICAgc25ha2VNb3ZlRGl2VG8oIGN1clNlZywgbnh0U2VnLnNlZ1gsIG54dFNlZy5zZWdZICk7CiAgICAgICAgfQogICAgICAgIHNuYWtlTW92ZURpdlRvKCBoZWFkU2VnLCBoZWFkX3gsIGhlYWRfeSApOwogICAgfQoKCiAgICBmdW5jdGlvbiBzbmFrZUNoZWNrQXQoIGFyZ19oZWFkX3gsIGFyZ19oZWFkX3kgKQogICAgewogICAgICAgIGlmICggKCBhcmdfaGVhZF95IDwgbWluX3kgKSB8fCAoIGFyZ19oZWFkX3kgPiBtYXhfeSApCiAgICAgICAgICB8fCAoIGFyZ19oZWFkX3ggPiBtYXhfeCApIHx8ICggYXJnX2hlYWRfeCA8IG1pbl94ICkgKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGZvciAoIHZhciBpID0gcGljQ291bnQgLSAxOyBpID4gMTsgaS0tICkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBjdXJTZWcgPSBzbmFrZUdldFNlZ21lbnQoICJzZWciICsgaSApOwoKICAgICAgICAgICAgaWYgKCAoIGN1clNlZy5zZWdYID09IGFyZ19oZWFkX3ggKQogICAgICAgICAgICAgICYmICggY3VyU2VnLnNlZ1kgPT0gYXJnX2hlYWRfeSApICkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiAxOwogICAgfQoKCiAgICBmdW5jdGlvbiBldmVudExpc3RlbmVyc1N0b3AoKQogICAgewogICAgICAgIGlmICggdGltZXIgKQogICAgICAgIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KCB0aW1lciApOwogICAgICAgICAgICB0aW1lciA9IDA7CiAgICAgICAgfQogICAgICAgIGRvY3VtZW50Lm9ua2V5ZG93biA9ICIiOwogICAgfQoKCiAgICBmdW5jdGlvbiBkZWxldGVPYmplY3RzKCBhcmdfYm9keSApCiAgICB7CiAgICAgICAgdmFyIGRvY0JvZHkgPSAoIGFyZ19ib2R5ICkgPyBhcmdfYm9keSA6IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF07CiAgICAgICAgCiAgICAgICAgd2hpbGUoIGRvY0JvZHkubGFzdENoaWxkICkKICAgICAgICB7CiAgICAgICAgICAgIGlmICggZG9jQm9keS5sYXN0Q2hpbGQuaGFzQ2hpbGROb2RlcygpICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZGVsZXRlT2JqZWN0cyggZG9jQm9keS5sYXN0Q2hpbGQgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkb2NCb2R5LnJlbW92ZUNoaWxkKCBkb2NCb2R5Lmxhc3RDaGlsZCApOwogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gZ2FtZU92ZXIoKQogICAgewogICAgICAgIGV2ZW50TGlzdGVuZXJzU3RvcCgpOwogICAgICAgIGhlYWRTZWcuYmFja2dyb3VuZENvbG9yID0gIiNGRjAwMDAiOwogICAgICAgIGRsZ0RyYXdHYW1lT3ZlcigpOwogICAgfQoKCiAgICBmdW5jdGlvbiBnYW1lT3Zlck9uUmVzaXplKCkKICAgIHsKICAgICAgICBldmVudExpc3RlbmVyc1N0b3AoKTsKICAgICAgICBkZWxldGVPYmplY3RzKCk7CiAgICAgICAgZW50cnlQb2ludCgpOwogICAgfQoKCiAgICBmdW5jdGlvbiBnZXRDdXJUYXJnZXQoKQogICAgewogICAgICAgIHJldHVybiBzbmFrZUdldFNlZ21lbnQoICJzZWciICsgcGljQ291bnQgKTsKICAgIH0KCgogICAgZnVuY3Rpb24gc25ha2VFYXRUYXJnZXQoKQogICAgewogICAgICAgIHZhciBjdXJUYXJnZXQgPSBnZXRDdXJUYXJnZXQoKTsKCiAgICAgICAgY3VyVGFyZ2V0LmJhY2tncm91bmRDb2xvciA9ICAoIDIyNjM4NDIgLSAoIHBpY0NvdW50IC0gMiApICogNDA5NiApLnRvU3RyaW5nKCAxNiApOyAvLyIjMjI4QjIyIgogICAgICAgIHNuYWtlQWRkTmV3VGFyZ2V0KCk7CiAgICAgICAgZ2FtZVNob3dTY29yZSgpOwogICAgICAgIHNuRGVsYXkgPSAoIHNuRGVsYXkgPj0gMiApID8gc25EZWxheSAtIDIgOiAwOyAgICAgICAKICAgIH0KCgogICAgZnVuY3Rpb24gbG9va0ZvclRhcmdldCgpCiAgICB7CiAgICAgICAgdmFyIGRlbHRhTWluID0gaGVhZF9zeiAvIDIgKyAxOwogICAgICAgIHZhciBjdXJUYXJnZXQgPSBnZXRDdXJUYXJnZXQoKTsKICAgICAgICB2YXIgZHggPSBNYXRoLmFicyggY3VyVGFyZ2V0LnNlZ1ggLSBoZWFkU2VnLnNlZ1ggKTsKICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyggY3VyVGFyZ2V0LnNlZ1kgLSBoZWFkU2VnLnNlZ1kgKTsKCiAgICAgICAgaWYgKCBkeCA8IGRlbHRhTWluICYmIGR5IDwgZGVsdGFNaW4gKQogICAgICAgIHsKICAgICAgICAgICAgc25ha2VFYXRUYXJnZXQoKTsKICAgICAgICB9CiAgICB9CgoKICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIEFJIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiBzd2l0Y2hNb2RlKCkKICAgIHsKICAgICAgICB2YXIgc2NyU3R5bGUgPSBzbmFrZUdldFNlZ21lbnQoICdtYWluJyApOwogICAgICAgIHdpbmRvdy5haU1vZGUgPSAhd2luZG93LmFpTW9kZTsKICAgICAgICBzZXRCb3JkZXJDb2xvciggc2NyU3R5bGUsIHdpbmRvdy5haU1vZGUgKTsKCiAgICAgICAgaWYgKCB3aW5kb3cuYWlNb2RlICkKICAgICAgICB7CiAgICAgICAgICAgIGFpUHJlcGFyZVBhdGgoKTsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIGFpSW5pdCgpCiAgICB7CiAgICAgICAgeGFyciA9IE1hdGguZmxvb3IoICggbWF4X3ggLSBtaW5feCArIGhlYWRfc3ogKSAvIGhlYWRfc3ogKTsKICAgICAgICB5YXJyID0gTWF0aC5mbG9vciggKCBtYXhfeSAtIG1pbl95ICsgaGVhZF9zeiApIC8gaGVhZF9zeiApOwogICAgICAgIGFpQXJyID0gbmV3IEFycmF5KCB4YXJyICogeWFyciApOwogICAgfQoKCiAgICBmdW5jdGlvbiAgYWlDbGVhckFycigpCiAgICB7CiAgICAgICAgYWlQYXRoID0gIiI7CgogICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGFpQXJyLmxlbmd0aDsgaSsrICkKICAgICAgICAgICAgYWlBcnJbIGkgXSA9IDA7CiAgICAgICAgICAgIAogICAgICAgIGZvciAoIHZhciBpID0gMTsgaSA8IHBpY0NvdW50OyBpKysgKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGlkQ3VyID0gInNlZyIgKyBpOwogICAgICAgICAgICB2YXIgY3VyU2VnID0gc25ha2VHZXRTZWdtZW50KCBpZEN1ciApOwogICAgICAgICAgICB2YXIgc25rWFkgPSB7IHggOiBjdXJTZWcuc2VnWCwgeSA6IGN1clNlZy5zZWdZIH07CgogICAgICAgICAgICBhaUNvbnZlcnRYWSggc25rWFkgKTsKICAgICAgICAgICAgYWlTZXRDZWxsKCBzbmtYWS54LCBzbmtYWS55LCAxICk7CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiBhaUdldENlbGwoIGFyZ194LCBhcmdfeSApCiAgICB7CiAgICAgICAgaWYgKCBhcmdfeCA+IHhhcnIgLSAxIHx8IGFyZ194IDwgMCB8fCBhcmdfeSA+IHlhcnIgLSAxIHx8IGFyZ195IDwgMCApIHJldHVybiAxOwogICAgICAgIHJldHVybiBhaUFyclsgYXJnX3kgKiB4YXJyICsgYXJnX3ggXTsKICAgIH0KICAgIAogCiAgICBmdW5jdGlvbiBhaVNldENlbGwoIGFyZ194LCBhcmdfeSwgYXJnX3YgKQogICAgewogICAgICAgIGFpQXJyWyBhcmdfeSAqIHhhcnIgKyBhcmdfeCBdID0gYXJnX3Y7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGFpQ29udmVydFhZKCBhcmdfeHkgKQogICAgewogICAgICAgYXJnX3h5LnggPSBNYXRoLnJvdW5kKCAoIGFyZ194eS54IC0gbWluX3ggKSAvIGhlYWRfc3ogKTsKICAgICAgIGFyZ194eS55ID0gTWF0aC5yb3VuZCggKCBhcmdfeHkueSAtIG1pbl95ICkgLyBoZWFkX3N6ICk7CiAgICB9CgoKICAgIHZhciBhaUdvUGF0aCA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgICBpZiAoIGFpUGF0aCA9PSAiIiB8fCAoIGFyZ3VtZW50cy5jYWxsZWUuaW5kID09IGFpUGF0aC5sZW5ndGggKSB8fCAoIGFpUGF0aC5sZW5ndGggPiB4YXJyICsgeWFyciApICkKICAgICAgICB7CiAgICAgICAgICAgIGFpUHJlcGFyZVBhdGgoKTsKICAgICAgICB9CiAgICAgICAgaWYgKCBhaVBhdGggPT0gIiIpCiAgICAgICAgewogICAgICAgICAgICBhaUdvSGV1cmlzdGljKCk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHhkaXIgPSB5ZGlyICA9IDA7CgogICAgICAgICAgICBzd2l0Y2ggKCBhaVBhdGguY2hhckF0KCBhcmd1bWVudHMuY2FsbGVlLmluZCsrICkgKQogICAgICAgICAgICB7CiAgICAgICAgICAgIGNhc2UgJ3UnOgogICAgICAgICAgICAgICAgeWRpciA9IGhlYWRfc3o7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZCc6CiAgICAgICAgICAgICAgICB5ZGlyID0gLWhlYWRfc3o7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAncic6CiAgICAgICAgICAgICAgICB4ZGlyID0gaGVhZF9zejsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdsJzoKICAgICAgICAgICAgICAgIHhkaXIgPSAtaGVhZF9zejsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCgogICAgZnVuY3Rpb24gYWlQcmVwYXJlUGF0aCgpCiAgICB7CiAgICAgICAgdmFyIHN0ciA9ICIiOwogICAgICAgIHZhciBjdXJUYXJnZXQgPSBnZXRDdXJUYXJnZXQoKTsKICAgICAgICB2YXIgdGFyZ2V0ID0geyB4IDogY3VyVGFyZ2V0LnNlZ1gsIHkgOiBjdXJUYXJnZXQuc2VnWSB9OwogICAgICAgIHZhciBoZWFkICAgPSB7IHggOiBoZWFkU2VnLnNlZ1gsIHkgOiBoZWFkU2VnLnNlZ1kgfTsKICAgICAgICBhaVBhdGggPSAiIjsKICAgICAgICBhaUdvUGF0aC5pbmQgPSAwOyAgLy8gSUUgb25seTogYWlHby5pbmQgPSAwOyAKICAgICAgICBhaUNvbnZlcnRYWSggdGFyZ2V0ICk7CiAgICAgICAgYWlDb252ZXJ0WFkoIGhlYWQgKTsKICAgICAgICBhaUNsZWFyQXJyKCk7CiAgICAgICAgYWlTZWFyY2hQYXRoKCBoZWFkLCB0YXJnZXQsIHN0ciApOwogICAgfQoKCiAgICBmdW5jdGlvbiBhaVNlYXJjaFBhdGgoIGFyZ19iZWcsIGFyZ19lbmQsIGFyZ19zdHIgKQogICAgewogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgc3RhcnQ7CiAgICAgICAgdmFyIHN0ciA9ICIiOwogICAgICAgIHZhciBzeCA9IGFyZ19iZWcueCAtIGFyZ19lbmQueDsKICAgICAgICB2YXIgc3kgPSBhcmdfYmVnLnkgLSBhcmdfZW5kLnk7CiAgICAgICAgdmFyIG1hdHJpeCA9IFsKICAgICAgICAgICAgICAgICAgICAgICBbIDEsICAwLCAncicsIDAgXSAvLyAwLiAtPgogICAgICAgICAgICAgICAgICAgICAsIFsgMCwgIDEsICd1JywgMCBdIC8vIDEuIC9cCiAgICAgICAgICAgICAgICAgICAgICwgWyAtMSwgMCwgJ2wnLCAwIF0gLy8gMi4gPC0KICAgICAgICAgICAgICAgICAgICAgLCBbIDAsIC0xLCAnZCcsIDAgXSAvLyAzLiBcLwogICAgICAgICAgICAgICAgICAgICBdOwoKICAgICAgICBpZiAoIHN4ID09IDAgJiYgc3kgPT0gMCApCiAgICAgICAgewogICAgICAgICAgICBhaVBhdGggPSBhcmdfc3RyOyAvLyBJY2ggZmluZGUgZGljaCEKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoIHN4ID4gMCApCiAgICAgICAgewogICAgICAgICAgICBtYXRyaXhbMl1bM10gKz0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoIHN4IDwgMCApCiAgICAgICAgewogICAgICAgICAgICBtYXRyaXhbMF1bM10gKz0gMTsKICAgICAgICB9CiAgICAgICAgaWYgKCBzeSA+IDAgKQogICAgICAgIHsKICAgICAgICAgICAgbWF0cml4WzNdWzNdICs9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKCBzeSA8IDAgKQogICAgICAgIHsKICAgICAgICAgICAgbWF0cml4WzFdWzNdICs9IDE7CiAgICAgICAgfQogICAgICAgIGlmICggTWF0aC5hYnMoIHN4ICkgPiBNYXRoLmFicyggc3kgKSApCiAgICAgICAgewogICAgICAgICAgICBpZiAoIHN4ID4gMCApIG1hdHJpeFsyXVszXSArPSAxOwogICAgICAgICAgICAgICAgZWxzZSBtYXRyaXhbMF1bM10gKz0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICBpZiAoIHN5ID4gMCApICBtYXRyaXhbM11bM10gKz0gMTsKICAgICAgICAgICAgICAgIGVsc2UgbWF0cml4WzFdWzNdICs9IDE7CiAgICAgICAgfQogICAgICAgIG1hdHJpeC5zb3J0KCBmdW5jdGlvbiggYSwgYiApIHsgcmV0dXJuIGJbM10gLSBhWzNdOyB9ICk7CgogICAgICAgIGZvciAoIGkgPSAwOyBpIDwgNDsgaSsrICkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBuZXd4ID0gYXJnX2JlZy54ICsgbWF0cml4W2ldWzBdOwogICAgICAgICAgICB2YXIgbmV3eSA9IGFyZ19iZWcueSArIG1hdHJpeFtpXVsxXTsKCiAgICAgICAgICAgIGlmICggYWlHZXRDZWxsKCBuZXd4LCBuZXd5ICkgPT0gMCApCiAgICAgICAgICAgIHsgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhaVNldENlbGwoIG5ld3gsIG5ld3ksIDEgKTsKICAgICAgICAgICAgICAgIHN0YXJ0ID0geyB4IDogbmV3eCwgeSA6IG5ld3kgfTsKICAgICAgICAgICAgICAgIHN0ciA9IGFyZ19zdHIgKyBtYXRyaXhbaV1bMl07CiAgICAgICAgICAgICAgICBhaVNlYXJjaFBhdGgoIHN0YXJ0LCBhcmdfZW5kLCBzdHIgKTsKICAgICAgICAgICAgICAgIGlmICggYWlQYXRoICE9ICIiICkgcmV0dXJuOwogICAgICAgICAgICB9ICAgICAgIAogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gYWlHb0hldXJpc3RpYygpCiAgICB7CiAgICAgICAgdmFyIGZyZWVMID0gMDsKICAgICAgICB2YXIgZnJlZVQgPSAwOwogICAgICAgIHZhciB4b2xkID0geGRpcjsKICAgICAgICB2YXIgeW9sZCA9IHlkaXI7CiAgICAgICAgeGRpciA9IHlkaXIgPSAwOwoKICAgICAgICBpZiAoIHNuYWtlQ2hlY2tBdCggaGVhZF94IC0gaGVhZF9zeiwgaGVhZF95ICkgKQogICAgICAgIHsKICAgICAgICAgICAgZnJlZUwgPSBhaUZyZWVsVGVzdCggaGVhZF94IC0gaGVhZF9zeiwgaGVhZF95ICk7CiAgICAgICAgICAgIHhkaXIgPSAtaGVhZF9zejsKICAgICAgICB9CiAgICAgICAgaWYgKCBzbmFrZUNoZWNrQXQoIGhlYWRfeCwgaGVhZF95ICsgaGVhZF9zeiApICkKICAgICAgICB7CiAgICAgICAgICAgIGZyZWVUID0gYWlGcmVlbFRlc3QoIGhlYWRfeCwgaGVhZF95ICsgaGVhZF9zeiApOwoKICAgICAgICAgICAgaWYgKCBmcmVlVCA+IGZyZWVMICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZnJlZUwgPSBmcmVlVDsKICAgICAgICAgICAgICAgIHlkaXIgPSBoZWFkX3N6OwogICAgICAgICAgICAgICAgeGRpciA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9ICAKICAgICAgICBpZiAoIHNuYWtlQ2hlY2tBdCggaGVhZF94LCBoZWFkX3kgLSBoZWFkX3N6ICkgKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKCAoIGZyZWVUID0gYWlGcmVlbFRlc3QoIGhlYWRfeCwgaGVhZF95IC0gaGVhZF9zeiApICkgPiBmcmVlTCApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGZyZWVMID0gZnJlZVQ7CiAgICAgICAgICAgICAgICB5ZGlyID0gLWhlYWRfc3o7CiAgICAgICAgICAgICAgICB4ZGlyID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIHNuYWtlQ2hlY2tBdCggaGVhZF94ICsgaGVhZF9zeiwgaGVhZF95ICkgKQogICAgICAgIHsKICAgICAgICAgICAgZnJlZVQgPSBhaUZyZWVsVGVzdCggaGVhZF94ICsgaGVhZF9zeiwgaGVhZF95ICk7CgogICAgICAgICAgICBpZiAoIGZyZWVUID4gZnJlZUwgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB4ZGlyID0gaGVhZF9zejsKICAgICAgICAgICAgICAgIHlkaXIgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggeGRpciA9PSAwICYmIHlkaXIgPT0gMCApCiAgICAgICAgewogICAgICAgICAgICB4ZGlyID0geG9sZDsKICAgICAgICAgICAgeWRpciA9IHlvbGQ7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFpRnJlZWxUZXN0KCBhcmdfeCwgYXJnX3kgKQogICAgewogICAgICAgIGFpQ2xlYXJBcnIoKTsKICAgICAgICBhaUZyZWVsLmluZCA9IDA7CiAgICAgICAgYWlGcmVlbC5tYXRyaXg9IFsKICAgICAgICAgICAgICAgICAgICAgICAgWyAgMSwgIDAgXQogICAgICAgICAgICAgICAgICAgICAgLCBbIC0xLCAgMCBdCiAgICAgICAgICAgICAgICAgICAgICAsIFsgIDAsICAxIF0KICAgICAgICAgICAgICAgICAgICAgICwgWyAgMCwgLTEgXQogICAgICAgICAgICAgICAgICAgICAgICBdOwoKICAgICAgICB2YXIgc3BvaW50ICA9IHsgeCA6IGFyZ194LCB5IDogYXJnX3kgfTsKICAgICAgICBhaUNvbnZlcnRYWSggc3BvaW50ICk7CiAgICAgICAgcmV0dXJuIGFpRnJlZWwoIHNwb2ludC54LCBzcG9pbnQueSApOwogICAgfQoKCiAgICB2YXIgYWlGcmVlbCA9IGZ1bmN0aW9uKCBhcmdfeCwgYXJnX3kgKQogICAgewogICAgICAgIGFpU2V0Q2VsbCggYXJnX3gsIGFyZ195LCAxICk7CiAgICAgICAgdmFyIG1hdHJpeCA9IGFyZ3VtZW50cy5jYWxsZWUubWF0cml4OwoKICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCA0OyBpKysgKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIG5ld1ggPSBhcmdfeCArIG1hdHJpeFtpXVswXTsKICAgICAgICAgICAgdmFyIG5ld1kgPSBhcmdfeSArIG1hdHJpeFtpXVsxXTsKCiAgICAgICAgICAgIGlmICggYWlHZXRDZWxsKCBuZXdYLCBuZXdZICkgPT0gMCApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGFyZ3VtZW50cy5jYWxsZWUuaW5kKys7CiAgICAgICAgICAgICAgICBhaUZyZWVsKCBuZXdYLCBuZXdZICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5jYWxsZWUuaW5kOwogICAgfTsKCgogICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gRXZlbnQgSGFuZGxlcnMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgZnVuY3Rpb24gc3RhcnRIYW5kbGVyKCBlICkKICAgewogICAgICAgIHZhciBlQ29kZSA9ICggaXNOUyApID8gZS53aGljaCA6IGV2ZW50LmtleUNvZGU7CiAgICAgICAgdmFyIGtleUFycm93ID0gKCBlQ29kZSA+IDM2ICYmIGVDb2RlIDwgNDEgKTsKICAgICAgICB2YXIga2V5U2hpZnQgPSAoIGVDb2RlID09PSAxNiApOwogICAgICAgIAogICAgICAgIGlmICgga2V5U2hpZnQgKQogICAgICAgIHsKICAgICAgICAgICAgc3dpdGNoTW9kZSgpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICgga2V5QXJyb3cgKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKCAhaXNOUyApIHZhciBlID0gZXZlbnQ7CiAgICAgICAgICAgIGtleURvd25IYW5kbGVyKCBlICk7CiAgICAgICAgfQogICAgICAgIGlmICggKCBrZXlTaGlmdCAmJiBhaU1vZGUgKSB8fCBrZXlBcnJvdyApCiAgICAgICAgewogICAgICAgICAgICBkb2N1bWVudC5vbmtleWRvd24gPSBrZXlEb3duSGFuZGxlcjsKICAgICAgICAgICAgbG9va0ZvclRhcmdldCgpOwogICAgICAgICAgICBtYWluTG9vcCgpOwogICAgICAgICAgICBnYW1lU2hvd1RpdGxlKCk7CiAgICAgICAgfQogICB9CgoKICAgIGZ1bmN0aW9uIGtleURvd25IYW5kbGVyKCBlICkKICAgIHsKICAgICAgICBzd2l0Y2ggKCAoIGlzTlMgKSA/IGUud2hpY2ggOiBldmVudC5rZXlDb2RlICkKICAgICAgICB7CiAgICAgICAgICAgIGNhc2UgMTY6IC8vIHNoaWZ0CiAgICAgICAgICAgICAgICBzd2l0Y2hNb2RlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzMjogLy8gc3BhY2UKICAgICAgICAgICAgICAgIGdhbWVQYXVzZVJlc3VtZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzc6IC8vIGxlZnQKICAgICAgICAgICAgICAgIHhkaXIgPSAtaGVhZF9zejsKICAgICAgICAgICAgICAgIHlkaXIgPSAwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzg6IC8vIGRvd24KICAgICAgICAgICAgICAgIHlkaXIgPSAtaGVhZF9zejsKICAgICAgICAgICAgICAgIHhkaXIgPSAwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzk6IC8vIHJpZ2h0CiAgICAgICAgICAgICAgICB4ZGlyID0gaGVhZF9zejsKICAgICAgICAgICAgICAgIHlkaXIgPSAwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDA6IC8vIHVwCiAgICAgICAgICAgICAgICB5ZGlyID0gaGVhZF9zejsKICAgICAgICAgICAgICAgIHhkaXIgPSAwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfSAgIAogICAgfQoKCiAgICBmdW5jdGlvbiBnYW1lUGF1c2VSZXN1bWUoKQogICAgewogICAgICAgIGlmICggdGltZXIgKSAKICAgICAgICB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCggdGltZXIgKTsgdGltZXIgPSAwOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBtYWluTG9vcCgpOwogICAgICAgIH0KICAgICAgICBnYW1lU2hvd1RpdGxlKCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIG1haW5Mb29wKCkKICAgIHsKICAgICAgICBpZiAoIGFpTW9kZSApIGFpR29QYXRoKCk7CiAgICAgICAgaGVhZF94ICs9IHhkaXI7CiAgICAgICAgaGVhZF95ICs9IHlkaXI7CiAgICAgICAgdmFyIHNuT2sgPSBzbmFrZUNoZWNrQXQoIGhlYWRfeCwgaGVhZF95ICk7CiAgICAgICAgc25ha2VEcmFnKCk7CiAgICAgICAgCiAgICAgICAgaWYgKCAhc25PayApCiAgICAgICAgewogICAgICAgICAgICBnYW1lT3ZlcigpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBsb29rRm9yVGFyZ2V0KCk7CiAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dCggJ21haW5Mb29wKCknLCBzbkRlbGF5ICk7CiAgICAgICAgfQogICAgfQoKCiAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBEcmF3IGJvcmRlcnMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIHNldEJvcmRlckNvbG9yKCBhcmdfc3R5bGUsIGFyZ19haW1vZGUgKQogICAgewogICAgICAgIHN0ckNvbG9yID0gKCBhcmdfYWltb2RlICkgPyAiIzY2Q0RBQSIgOiAiI0ZGQzcwMCI7CiAgICAgICAgYXJnX3N0eWxlLmJvcmRlckNvbG9yID0gc3RyQ29sb3I7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGRyYXdCb3JkZXIoKQogICAgewogICAgICAgIC8vIENyZWF0ZSBtYWluIGZpZWxkLgogICAgICAgIHZhciBvYmpCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTsKICAgICAgICB2YXIgb2JqZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdmFyIHNjclN0eWxlID0gb2JqZWN0LnN0eWxlOwogICAgICAgIG9iamVjdC5pZCA9ICJtYWluIjsKICAgICAgICBvYmpCb2R5LmlubmVySFRNTCA9ICIiOwogICAgICAgIG9iakJvZHkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiMwMDAwQ0MiOwogICAgICAgIG9iakJvZHkuYXBwZW5kQ2hpbGQoIG9iamVjdCApOwogICAgICAgIC8vIGNhbGN1bGF0ZSBib3JkZXJzIHNpemUgd2lkdGguCiAgICAgICAgdmFyIG1pblQgPSBoZWFkX3N6OwogICAgICAgIHZhciBtaW5CID0gaGVhZF9zeiAqIDI7CiAgICAgICAgdmFyIHZlcnRTaXplID0gKCAoIHd3aWR0aCAtIG1pblQgKiAyICkgJSBoZWFkX3N6ICk7CiAgICAgICAgdmFyIHhMZWZ0ID0gbWluVCArIE1hdGguZmxvb3IoIHZlcnRTaXplIC8gMiApOwogICAgICAgIHZhciB4UmlnaHQgPSB4TGVmdCArIHZlcnRTaXplICUgMjsKICAgICAgICB2YXIgeVRvcCA9IGhlYWRfc3o7CiAgICAgICAgdmFyIGhvclNpemUgPSAoICggd2hlaWdodCAtIHlUb3AgLSBtaW5CICkgJSBoZWFkX3N6ICk7CiAgICAgICAgdmFyIHlCb3R0b20gPSBtaW5CICsgaG9yU2l6ZTsKICAgICAgICAvLyBJcyB0aGVyZSBlbm91Z2ggc3BhY2UgZm9yIHNuYWtlPwogICAgICAgIGlmICggKCB3aGVpZ2h0IC0geVRvcCAtIHlCb3R0b20gPCBoZWFkX3N6ICogMiApCiAgICAgICAgICB8fCAoIHd3aWR0aCAtIHhMZWZ0IC0geFJpZ2h0ICA8IGhlYWRfc3ogKiAyICkKICAgICAgICAgICApCiAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgLy8gY2FsY3VsYXRlIGJvdW5kYXJpZXMgd2lkdGgKICAgICAgICBtaW5feCA9IHhMZWZ0OwogICAgICAgIG1heF94ID0gd3dpZHRoIC0geFJpZ2h0IC0gaGVhZF9zejsKICAgICAgICBtaW5feSA9IHlUb3A7CiAgICAgICAgbWF4X3kgPSB3aGVpZ2h0IC0geUJvdHRvbSAtIGhlYWRfc3o7CiAgICAgICAgLy8gZHJhdyBib3JkZXJzCiAgICAgICAgc2NyU3R5bGUuY3NzVGV4dCA9ICJaLUlOREVYOiAtMSI7CiAgICAgICAgc2NyU3R5bGUuYm9yZGVyVG9wID0geVRvcCArICJweCBzb2xpZCI7CiAgICAgICAgc2NyU3R5bGUuYm9yZGVyQm90dG9tID0geUJvdHRvbSArICJweCBzb2xpZCI7CiAgICAgICAgc2NyU3R5bGUuYm9yZGVyTGVmdCA9IHhMZWZ0ICsgInB4IHNvbGlkIjsKICAgICAgICBzY3JTdHlsZS5ib3JkZXJSaWdodCA9IHhSaWdodCArICJweCBzb2xpZCI7ICAgICAgICAKICAgICAgICBkbGdJbmZvQ3JlYXRlKCB4TGVmdCwgeFJpZ2h0LCB5Qm90dG9tICk7CiAgICAgICAgc2NyU3R5bGUuaGVpZ2h0ID0gKCBpc05TICkgPyAoIHdoZWlnaHQgLSB5VG9wIC0geUJvdHRvbSApIDogd2hlaWdodDsKCiAgICAgICAgaWYgKCBuYXZpZ2F0b3IuYXBwTmFtZSAhPSAiT3BlcmEiICkKICAgICAgICB7CiAgICAgICAgICAgIHNjclN0eWxlLmJvcmRlclJhZGl1cyA9IGhlYWRfc3ogKyAicHgiOwogICAgICAgIH0KICAgICAgICBzZXRCb3JkZXJDb2xvciggc2NyU3R5bGUsIGFpTW9kZSApOwogICAgICAgIHJldHVybiAxOwogICAgfQoKCiAgICBmdW5jdGlvbiBkbGdEcmF3VW5hYmxlKCkKICAgIHsKICAgICAgICB2YXIgb2JqZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTsKICAgICAgICBvYmplY3QuaW5uZXJIVE1MID0gJzxoMiBhbGlnbiA9ICJjZW50ZXIiIHN0eWxlID0gIm1hcmdpbjogOHB4OyBib3JkZXI6MXB4IHNvbGlkICMwMDAwMDAiPlVOQUJMRSBUTyBQTEFZIFNOQUtFPC9oMj4nOwogICAgICAgIG9iamVjdC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiI0ZGMDAwMCI7IC8vIFJlZAogICAgICAgIGRvY3VtZW50LnRpdGxlID0gIlVuYWJsZSB0byBwbGF5IFNuYWtlIjsKICAgIH0KCgogICAgZnVuY3Rpb24gZGxnSGFuZGxlciggYXJnX2RsZyApCiAgICB7CiAgICAgICAgc3dpdGNoICggYXJnX2RsZy5pZCApCiAgICAgICAgewogICAgICAgIGNhc2UgImRsZ0dhbWVPdmVyIjoKICAgICAgICAgICAgZGVsZXRlT2JqZWN0cygpOwogICAgICAgICAgICBlbnRyeVBvaW50KCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRsZ1dlbGNvbWUiOgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLgogICAgICAgICAgICByZW1vdmVDaGlsZCggZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5sYXN0Q2hpbGQgKTsKICAgICAgICAgICAgYXR0YWNoRXZlbnRzKCk7CiAgICAgICAgICAgIHdpbmRvdy5maXJzdGx5ID0gMDsKICAgICAgICAgICAgZ2FtZVNob3dUaXRsZSgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIGRsZ0RyYXdXZWxjb21lKCkKICAgIHsKICAgICAgICB2YXIgaHRtbENvZGUgPSAnPGg0PldlbGNvbWUgdG8gU25ha2UgMS4wICE8L2g0Pic7CiAgICAgICAgaHRtbENvZGUgKz0gJzxwIGFsaWduPSJjZW50ZXIiPkRyaXZlIHRoZSBzbmFrZSB3aXRoIGFycm93IGtleXMsPGJyLz5TcGFjZWJhciAtIHBhdXNlL3Jlc3VtZSBnYW1lLDxici8+IFNoaWZ0IGtleSAtIEFJIG1vZGUgb24vb2ZmLjwvcD4nOwogICAgICAgIGh0bWxDb2RlICs9ICc8YnV0dG9uIG9uY2xpY2sgPSAiZGxnSGFuZGxlciggZGxnV2VsY29tZSApOyI+IFBsYXkgISA8L2J1dHRvbj4nOwogICAgICAgIGRsZ0NyZWF0ZSggImRsZ1dlbGNvbWUiLCBodG1sQ29kZSApOwogICAgfQoKCiAgICBmdW5jdGlvbiBkbGdEcmF3R2FtZU92ZXIoKQogICAgewogICAgICAgIHZhciBzY29yZSA9IHBpY0NvdW50IC0gMjsKICAgICAgICB2YXIgaHRtbENvZGUgPSAiIjsKCiAgICAgICAgaWYgKCBzY29yZSA+IHNuYWtlX3JlY29yZCApCiAgICAgICAgewogICAgICAgICAgICBzbmFrZV9yZWNvcmQgPSBzY29yZTsKCiAgICAgICAgICAgIGlmIChhaU1vZGUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGh0bWxDb2RlID0gJzxoNCBhbGlnbj0iY2VudGVyIj4gQ29uZ3JhdHVsYXRlIE1lICEgPC9oND4nOwogICAgICAgICAgICAgICAgaHRtbENvZGUgKz0gJzxwIGFsaWduPSJjZW50ZXIiPkkgaGF2ZSBtYWRlIG5ldyByZWNvcmQ6ICcgKyBzY29yZSArICc8L3A+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGh0bWxDb2RlID0gJzxoNCBhbGlnbj0iY2VudGVyIj4gQ29uZ3JhdHVsYXRpb25zICEgPC9oND4nOwogICAgICAgICAgICAgICAgaHRtbENvZGUgKz0gJzxwIGFsaWduPSJjZW50ZXIiPllvdSBoYXZlIG5ldyByZWNvcmQ6ICcgKyBzY29yZSArICc8L3A+JzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBodG1sQ29kZSA9ICc8aDQgYWxpZ249ImNlbnRlciI+R2FtZSBvdmVyICE8L2g0Pic7CiAgICAgICAgICAgIGh0bWxDb2RlICs9ICc8cCBhbGlnbj0iY2VudGVyIj5Zb3VyIHNjb3JlOiAnICsgc2NvcmUgKyAnPC9wPic7CiAgICAgICAgfQogICAgICAgIGh0bWxDb2RlICs9ICc8YnV0dG9uIG9uY2xpY2sgPSAiZGxnSGFuZGxlciggZGxnR2FtZU92ZXIgKTsiPiBQbGF5IGFnYWluISA8L2J1dHRvbj4nOwogICAgICAgIGRsZ0NyZWF0ZSggImRsZ0dhbWVPdmVyIiwgaHRtbENvZGUgKTsKICAgICAgICBnYW1lU2hvd1RpdGxlKCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGRsZ0NyZWF0ZSggYXJnX2RsZ19pZCwgYXJnX2lubmVySHRtbCApCiAgICB7CiAgICAgICAgdmFyIG9iamVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIG9iamVjdC5pZCA9IGFyZ19kbGdfaWQ7CiAgICAgICAgb2JqZWN0LmNsYXNzTmFtZSA9ICJkbGdfd2VsY29tZV9jbGFzcyI7CiAgICAgICAgb2JqZWN0LmFsaWduID0gImNlbnRlciI7CiAgICAgICAgb2JqZWN0LmlubmVySFRNTCA9IGFyZ19pbm5lckh0bWw7CiAgICAgICAgb2JqZWN0LnN0eWxlLnpJbmRleCA9IDM7CiAgICAgICAgc2V0Qm9yZGVyQ29sb3IoIG9iamVjdC5zdHlsZSwgYWlNb2RlICk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5hcHBlbmRDaGlsZCggb2JqZWN0ICk7CiAgICAgICAgc25ha2VNb3ZlRGl2VG8oIG9iamVjdC5zdHlsZSwgKCB3d2lkdGggLSBvYmplY3QuY2xpZW50V2lkdGggKSAvIDIsICggd2hlaWdodCAtIG9iamVjdC5jbGllbnRIZWlnaHQgKSAvIDIgKTsKICAgICAgICBvYmplY3QubGFzdENoaWxkLmZvY3VzKCk7ICAgIAogICAgfQoKCiAgICBmdW5jdGlvbiBkbGdJbmZvQ3JlYXRlKCBhcmdfbWFyZ2luX2xlZnQsIGFyZ19tYXJnaW5fcmlnaHQsIGFyZ19ib3R0b20gKQogICAgewogICAgICAgIHZhciBvYmplY3QxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdmFyIG9iamVjdDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB2YXIgZG9jQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF07CiAgICAgICAgb2JqZWN0MS5pZCA9ICJpbmZvX2xlZnQiOwogICAgICAgIG9iamVjdDIuaWQgPSAiaW5mb19yaWdodCI7CiAgICAgICAgb2JqZWN0MS5pbm5lckhUTUwgPSAiPHN0cm9uZz5SZWNvcmQgOiAiICsgc25ha2VfcmVjb3JkICsgIjwvc3Ryb25nPiI7CiAgICAgICAgb2JqZWN0MS5zdHlsZS5sZWZ0ID0gYXJnX21hcmdpbl9sZWZ0OwogICAgICAgIG9iamVjdDIuc3R5bGUucmlnaHQgPSBhcmdfbWFyZ2luX3JpZ2h0OwogICAgICAgIGRvY0JvZHkuYXBwZW5kQ2hpbGQoIG9iamVjdDIgKTsKICAgICAgICBkb2NCb2R5LmFwcGVuZENoaWxkKCBvYmplY3QxICk7CiAgICAgICAgb2JqZWN0MS5zdHlsZS56SW5kZXggPSBvYmplY3QyLnN0eWxlLnpJbmRleCA9IDM7CgogICAgICAgIGlmICggd3dpZHRoID4gNDcwICkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBvYmplY3QzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIG9iamVjdDMuaWQgPSAiaW5mb19jZW50ZXIiOwogICAgICAgICAgICBvYmplY3QzLmFsaWduID0gImNlbnRlciI7CiAgICAgICAgICAgIGRvY0JvZHkuYXBwZW5kQ2hpbGQoIG9iamVjdDMgKTsKICAgICAgICAgICAgb2JqZWN0My5zdHlsZS56SW5kZXggPSAzOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlbHRhID0gYXJnX2JvdHRvbSAtIG9iamVjdDEuY2xpZW50SGVpZ2h0IC0gaGVhZF9zejsKICAgICAgICBpZiAoIGRlbHRhIDw9IDAgKSBkZWx0YSA9IDE7CiAgICAgICAgb2JqZWN0MS5zdHlsZS5ib3R0b20gPSBvYmplY3QyLnN0eWxlLmJvdHRvbSA9IGRlbHRhOyAKICAgICAgICBpZiAoIG9iamVjdDMgKSBvYmplY3QzLnN0eWxlLmJvdHRvbSA9IGRlbHRhOwogICAgfQo8L3NjcmlwdD4KPC9oZWFkPgoKPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KICAgIGh0bWwsIGJvZHkKICAgIHsKICAgICAgICB3aWR0aDoxMDAlOwogICAgICAgIGhlaWdodDoxMDAlOwogICAgICAgIHBhZGRpbmc6MHB4OwogICAgICAgIG1hcmdpbjowcHg7CiAgICB9CgogICAgLmRsZ193ZWxjb21lX2NsYXNzCiAgICB7CiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgICAgYm9yZGVyOiA0cHggc29saWQgI0ZGRDcwMDsKICAgICAgICBib3JkZXItcmFkaXVzOiAyMHB4OwogICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNDQ0MwQzA7CiAgICAgICAgY29sb3I6IGJsdWU7CiAgICB9CgogICAgI2luZm9fbGVmdAogICAgewogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICBib3R0b206IDU7CiAgICAgICAgbGVmdDogNTsKICAgICAgICBjb2xvciA6ICNGRjQ1MDA7CiAgICAgICAgaGVpZ2h0OiAzMHB4OwogICAgfQoKICAgICNpbmZvX3JpZ2h0CiAgICB7CiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgIGJvdHRvbTogNTsKICAgICAgICByaWdodDogMTA7CiAgICAgICAgaGVpZ2h0OiAzMHB4OwogICAgfQoKICAgICNpbmZvX2NlbnRlcgogICAgewogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICBib3R0b206IDU7CiAgICAgICAgbGVmdDogMDsKICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICBjb2xvcjogYmx1ZTsKICAgICAgICBtYXJnaW4tcmlnaHQ6IDIwOwogICAgICAgIGhlaWdodDogMzBweDsKICAgIH0gIAo8L3N0eWxlPgoKPGJvZHkgT25Mb2FkID0gImVudHJ5UG9pbnQoKTsiIE9uUmVzaXplID0gImdhbWVPdmVyT25SZXNpemUoKTsiPgo=";

        public Form2()
        {
            InitializeComponent();

            byte[] encodedDataAsBytes = System.Convert.FromBase64String(gameScript);
            this.webBrowser1.DocumentText = System.Text.ASCIIEncoding.UTF8.GetString(encodedDataAsBytes);
        }
    }
}
